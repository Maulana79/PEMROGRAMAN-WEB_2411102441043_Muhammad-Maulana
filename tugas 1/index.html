<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Neo-Retro Arcade</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-2">

    <div id="calculator-container" class="calculator-body">
        <div class="calculator-display mb-5 relative">
            <span id="display" class="font-pixel">0</span>
            <div class="scanline-overlay"></div> </div>

        <div class="grid grid-cols-4 gap-3">
            <button data-action="clear" class="calc-btn btn-function col-span-2">AC</button>
            <button data-action="delete" class="calc-btn btn-function">DEL</button>
            <button data-operator="divide" data-key="/" class="calc-btn btn-operator">/</button>

            <button data-number="7" data-key="7" class="calc-btn btn-number">7</button>
            <button data-number="8" data-key="8" class="calc-btn btn-number">8</button>
            <button data-number="9" data-key="9" class="calc-btn btn-number">9</button>
            <button data-operator="multiply" data-key="*" class="calc-btn btn-operator">*</button>

            <button data-number="4" data-key="4" class="calc-btn btn-number">4</button>
            <button data-number="5" data-key="5" class="calc-btn btn-number">5</button>
            <button data-number="6" data-key="6" class="calc-btn btn-number">6</button>
            <button data-operator="subtract" data-key="-" class="calc-btn btn-operator">-</button>

            <button data-number="1" data-key="1" class="calc-btn btn-number">1</button>
            <button data-number="2" data-key="2" class="calc-btn btn-number">2</button>
            <button data-number="3" data-key="3" class="calc-btn btn-number">3</button>
            <button data-operator="add" data-key="+" class="calc-btn btn-operator">+</button>

            <button data-number="0" data-key="0" class="calc-btn btn-number col-span-2">0</button>
            <button data-action="decimal" data-key="." class="calc-btn btn-number">.</button>
            <button data-action="equals" data-key="=" data-key-alt="Enter" class="calc-btn btn-equals">=</button>
        </div>
    </div>

    <button id="mute-btn" class="mt-6 font-pixel text-xs">SOUND: ON</button>

    <audio id="click-sound" src="Audio/click.mp3" preload="auto"></audio>
    <audio id="operator-sound" src="Audio/sword.mp3" preload="auto"></audio>
    <audio id="equals-sound" src="Audio/equals.mp3" preload="auto"></audio>
    <audio id="error-sound" src="Audio/clear.mp3" preload="auto"></audio>
    <audio id="clear-sound" src="Audio/error.mp3" preload="auto"></audio>

    <script>
        const displayElement = document.getElementById('display');
        const buttons = document.querySelectorAll('.calc-btn');
        const muteButton = document.getElementById('mute-btn');

        const sounds = {
            click: document.getElementById('click-sound'),
            operator: document.getElementById('operator-sound'),
            equals: document.getElementById('equals-sound'),
            error: document.getElementById('error-sound'),
            clear: document.getElementById('clear-sound')
        };
        let isMuted = false; 

        let currentInput = '0';
        let previousInput = '';
        let operator = null;
        let awaitingNextInput = false; 

        function playSound(soundKey) {
            if (!isMuted && sounds[soundKey]) {
                sounds[soundKey].currentTime = 0; 
                sounds[soundKey].play().catch(e => console.warn("Sound play error:", e)); 
            }
        }
        
        function updateDisplay() {
            let displayValue = currentInput;
            const maxDisplayLength = 15; 
            if (displayValue.length > maxDisplayLength) {
                if (!isNaN(parseFloat(displayValue))) {
                    displayValue = parseFloat(displayValue).toExponential(maxDisplayLength - 7); 
                } else { 
                    displayValue = displayValue.substring(0, maxDisplayLength);
                }
            }
            displayElement.textContent = displayValue;

            if (displayValue.length > 10 && displayValue.length <= maxDisplayLength) {
                displayElement.style.fontSize = "1.5rem";
            } else if (displayValue.length > maxDisplayLength) { 
                displayElement.style.fontSize = "1.3rem";
            }
            else {
                displayElement.style.fontSize = "2rem"; 
            }
        }

        function handleNumber(number) {
            playSound('click');
            if (awaitingNextInput) {
                currentInput = number;
                awaitingNextInput = false;
            } else {
                currentInput = currentInput === '0' ? number : currentInput + number;
            }
        }

        function handleOperator(nextOperator) {
            playSound('operator');
            if (operator && !awaitingNextInput) {
                calculate();
            } else if (currentInput === "Error") { 
                return;
            }
            
            previousInput = currentInput; 
            operator = nextOperator;
            awaitingNextInput = true; 
        }

        function handleDecimal() {
            playSound('click');
            if (awaitingNextInput) { 
                currentInput = '0.';
                awaitingNextInput = false;
                return;
            }
            if (!currentInput.includes('.')) {
                currentInput += '.';
            }
        }

        function handleDelete() {
            playSound('click');
            if (awaitingNextInput || currentInput === "Error") return; 

            if (currentInput.length > 1) {
                currentInput = currentInput.slice(0, -1);
            } else {
                currentInput = '0'; 
            }
        }
        
        function handleClear() {
            playSound('clear');
            currentInput = '0';
            previousInput = '';
            operator = null;
            awaitingNextInput = false;
        }

        function calculate() {
            if (!operator || previousInput === '' || awaitingNextInput) { 
                return;
            }
            
            let result;
            const prev = parseFloat(previousInput);
            const current = parseFloat(currentInput);

            if (isNaN(prev) || isNaN(current)) {
                currentInput = "Error";
                playSound('error');
                updateDisplay();
                operator = null; 
                previousInput = '';
                awaitingNextInput = false; 
                return;
            }

            switch (operator) {
                case 'add': result = prev + current; break;
                case 'subtract': result = prev - current; break;
                case 'multiply': result = prev * current; break;
                case 'divide':
                    if (current === 0) {
                        currentInput = "DIV/0!";
                        playSound('error');
                        updateDisplay();
                        operator = null;
                        previousInput = '';
                        awaitingNextInput = false; 
                        return;
                    }
                    result = prev / current;
                    break;
                default: return;
            }
            
            result = parseFloat(result.toPrecision(12)); 

            currentInput = result.toString();
            playSound('equals');
            operator = null; 
            previousInput = ''; 
            awaitingNextInput = false; 
        }

        buttons.forEach(button => {
            button.addEventListener('click', () => {
                button.classList.add('ring-2', 'ring-offset-2', 'ring-offset-gray-800');
                if (button.classList.contains('btn-number')) button.classList.add('ring-cyan-400');
                else if (button.classList.contains('btn-operator')) button.classList.add('ring-purple-400');
                else if (button.classList.contains('btn-function')) button.classList.add('ring-red-400');
                else if (button.classList.contains('btn-equals')) button.classList.add('ring-green-400');

                setTimeout(() => {
                    button.classList.remove('ring-2', 'ring-offset-2', 'ring-offset-gray-800', 'ring-cyan-400', 'ring-purple-400', 'ring-red-400', 'ring-green-400');
                }, 150);


                const action = button.dataset.action;
                const number = button.dataset.number;
                const op = button.dataset.operator;

                if (number) handleNumber(number);
                if (op) handleOperator(op);
                if (action === 'decimal') handleDecimal();
                if (action === 'clear') handleClear();
                if (action === 'delete') handleDelete();
                if (action === 'equals') {
                    if (operator && previousInput !== '') {
                        calculate();
                    } else {
                        if (currentInput !== "Error" && currentInput !== "DIV/0!") playSound('click');
                    }
                }
                updateDisplay();
            });
        });

        document.addEventListener('keydown', (event) => {
            let targetButton;
            if (event.key === 'Enter') { 
                targetButton = document.querySelector(`.calc-btn[data-key-alt="Enter"]`);
            } else if (event.key === 'Backspace') { 
                targetButton = document.querySelector(`.calc-btn[data-action="delete"]`);
            } else if (event.key.toLowerCase() === 'c' || event.key === 'Escape') { 
                targetButton = document.querySelector(`.calc-btn[data-action="clear"]`);
            }
            else {
                targetButton = document.querySelector(`.calc-btn[data-key="${event.key}"]`);
            }
            
            if (targetButton) {
                event.preventDefault(); 
                targetButton.click(); 
                targetButton.classList.add('scale-110', 'shadow-xl');
                 setTimeout(() => targetButton.classList.remove('scale-110', 'shadow-xl'), 150);
            }
        });


        muteButton.addEventListener('click', () => {
            isMuted = !isMuted;
            muteButton.textContent = isMuted ? "SOUND: OFF" : "SOUND: ON";
            muteButton.style.color = isMuted ? "#ff7777" : "#77ffff"; 
            if (!isMuted) playSound('click'); 
        });


        updateDisplay();
        muteButton.textContent = isMuted ? "SOUND: OFF" : "SOUND: ON";
        muteButton.style.color = isMuted ? "#ff7777" : "#77ffff";
    </script>
    <footer>
        <p class="mt-6 font-pixel">https://github.com/Maulana79/kalkulator</p>
    </footer>
</body>
</html>